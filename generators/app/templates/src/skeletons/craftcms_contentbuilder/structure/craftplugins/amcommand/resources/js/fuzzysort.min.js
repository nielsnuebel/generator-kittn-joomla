!function(e,r){"function"==typeof define&&define.amd?define([],r):"object"==typeof module&&module.exports?module.exports=r():e.fuzzysort=r()}(this,function(){function e(g){var d={single:function(e,r,t){if("object"!=typeof e){var n=f.get(e);void 0!==n?e=n:f.set(e,e=d.prepareSearch(e))}if(0===e.length)return null;if("object"!=typeof r){var o=l.get(r);void 0!==o?r=o:l.set(r,r=d.prepareFast(r))}return 0===r._targetLowerCodes.length?null:d.algorithm(e,r,e[0])},go:function(e,r,o){if("object"!=typeof e){var a=f.get(e);void 0!==a?e=a:f.set(e,e=d.prepareSearch(e))}if(0===e.length)return s;var i=e[0],u=o&&o.threshold||g&&g.threshold||-(1/0),c=o&&o.limit||g&&g.limit||1/0,p=0,h=0;if(o&&o.keys)for(var y=o.scoreFn||t,w=o.keys,m=w.length,b=r.length-1;b>=0;--b){for(var x=r[b],k=new Array(m),j=m-1;j>=0;--j){var C=w[j],L=n(x,C);if("object"!=typeof L){var I=l.get(L);void 0!==I?L=I:l.set(L,L=d.prepareFast(L))}0!==L._targetLowerCodes.length?k[j]=d.algorithm(e,L,i):k[j]=null}var _=y(k);null!==_&&(u>_||(k.obj=x,k.score=_,c>p?(v.add(k),++p):(++h,_>v.peek().score&&v.replaceTop(k))))}else if(o&&o.key)for(var C=o.key,b=r.length-1;b>=0;--b){var x=r[b],L=n(x,C);if("object"!=typeof L){var I=l.get(L);void 0!==I?L=I:l.set(L,L=d.prepareFast(L))}if(0!==L._targetLowerCodes.length){var A=d.algorithm(e,L,i);null!==A&&(A.score<u||(A.obj=x,c>p?(v.add(A),++p):(++h,A.score>v.peek().score&&v.replaceTop(A))))}}else for(var b=r.length-1;b>=0;--b){var L=r[b];if("object"!=typeof L){var I=l.get(L);void 0!==I?L=I:l.set(L,L=d.prepareFast(L))}if(0!==L._targetLowerCodes.length){var A=d.algorithm(e,L,i);null!==A&&(A.score<u||(c>p?(v.add(A),++p):(++h,A.score>v.peek().score&&v.replaceTop(A))))}}if(0===p)return s;for(var F=new Array(p),b=p-1;b>=0;--b)F[b]=v.poll();return F.total=p+h,F},goAsync:function(e,r,a){var u=!1,c=new Promise(function(c,v){function h(){if(u)return v("canceled");var f=Date.now();if(a&&a.keys)for(var p=a.scoreFn||t,g=a.keys,y=g.length,I=r.length-1;I>=0;--I){for(var _=r[I],A=new Array(y),F=y-1;F>=0;--F){var T=g[F],B=n(_,T);if("object"!=typeof B){var D=l.get(B);void 0!==D?B=D:l.set(B,B=d.prepareFast(B))}0!==B._targetLowerCodes.length?A[F]=d.algorithm(e,B,w):A[F]=null}var S=p(A);if(null!==S&&!(k>S)&&(A.obj=_,A.score=S,j>C?(b.add(A),++C):(++L,S>b.peek().score&&b.replaceTop(A)),x%m===0&&Date.now()-f>=i))return void(o?setImmediate(h):setTimeout(h))}else if(a&&a.key)for(var T=a.key;x>=0;--x){var _=r[x],B=n(_,T);if("object"!=typeof B){var D=l.get(B);void 0!==D?B=D:l.set(B,B=d.prepareFast(B))}if(0!==B._targetLowerCodes.length){var N=d.algorithm(e,B,w);if(null!==N&&!(N.score<k)&&(N.obj=_,j>C?(b.add(N),++C):(++L,N.score>b.peek().score&&b.replaceTop(N)),x%m===0&&Date.now()-f>=i))return void(o?setImmediate(h):setTimeout(h))}}else for(;x>=0;--x){var B=r[x];if("object"!=typeof B){var D=l.get(B);void 0!==D?B=D:l.set(B,B=d.prepareFast(B))}if(0!==B._targetLowerCodes.length){var N=d.algorithm(e,B,w);if(null!==N&&!(N.score<k)&&(j>C?(b.add(N),++C):(++L,N.score>b.peek().score&&b.replaceTop(N)),x%m===0&&Date.now()-f>=i))return void(o?setImmediate(h):setTimeout(h))}}if(0===C)return c(s);for(var z=new Array(C),I=C-1;I>=0;--I)z[I]=b.poll();z.total=C+L,c(z)}if("object"!=typeof e){var y=f.get(e);void 0!==y?e=y:f.set(e,e=d.prepareSearch(e))}if(0===e.length)return c(s);var w=e[0],m=1e3,b=p(),x=r.length-1,k=a&&a.threshold||g&&g.threshold||-(1/0),j=a&&a.limit||g&&g.limit||Infinity,C=0,L=0;o?setImmediate(h):h()});return c.cancel=function(){u=!0},c},highlight:function(e,r,t){if(null===e)return null;void 0===r&&(r="<b>"),void 0===t&&(t="</b>");for(var n="",o=0,a=!1,i=e.target,l=i.length,f=e.indexes,s=0;l>s;++s){var u=i[s];if(f[o]===s){if(++o,a||(a=!0,n+=r),o===f.length){n+=u+t+i.substr(s+1);break}}else a&&(a=!1,n+=t);n+=u}return n},prepare:function(e){return{target:e,_targetLowerCodes:d.prepareLowerCodes(e),_nextBeginningIndexes:d.prepareNextBeginningIndexes(e),score:null,indexes:null,obj:null}},prepareSearch:function(e){return d.prepareLowerCodes(e)},algorithm:function(e,r,t){for(var n=r._targetLowerCodes,o=e.length,i=n.length,l=0,f=0,s=0,p=0;;){var v=t===n[f];if(v){if(u[p++]=f,++l,l===o)break;t=e[0===s?l:s===l?l+1:s===l-1?l-1:l]}if(++f,f>=i)for(;;){if(1>=l)return null;if(0===s){--l;var g=e[l];if(t===g)continue;s=l}else{if(1===s)return null;--s,l=s,t=e[l+1];var g=e[l];if(t===g)continue}p=l,f=u[p-1]+1;break}}var l=0,h=0,y=!1,w=0,m=r._nextBeginningIndexes;null===m&&(m=r._nextBeginningIndexes=d.prepareNextBeginningIndexes(r.target));var b=f=0===u[0]?0:m[u[0]-1];if(f!==i)for(;;)if(f>=i){if(0>=l){if(++h,h>o-2)break;if(e[h]===e[h+1])continue;f=b;continue}--l;var x=c[--w];f=m[x]}else{var v=e[0===h?l:h===l?l+1:h===l-1?l-1:l]===n[f];if(v){if(c[w++]=f,++l,l===o){y=!0;break}++f}else f=m[f]}if(y)var k=c,j=w;else var k=u,j=p;for(var C=0,L=-1,I=0;o>I;++I){var f=k[I];L!==f-1&&(C-=f),L=f}y?0!==h&&(C+=a):(C*=1e3,0!==s&&(C+=a)),C-=i-o,r.score=C,r.indexes=new Array(j);for(var I=j-1;I>=0;--I)r.indexes[I]=k[I];return r},prepareFast:function(e){return{target:e,_targetLowerCodes:d.prepareLowerCodes(e),_nextBeginningIndexes:null,score:null,indexes:null,obj:null}},prepareLowerCodes:function(e){for(var r=new Array(e.length),t=e.toLowerCase(),n=e.length,o=0;n>o;++o)r[o]=t.charCodeAt(o);return r},prepareBeginningIndexes:function(e){for(var r=e.length,t=[],n=0,o=!1,a=!1,i=0;r>i;++i){var l=e.charCodeAt(i),f=l>=65&&90>=l,s=f||l>=97&&122>=l||l>=48&&57>=l,u=f&&!o||!a||!s;o=f,a=s,u&&(t[n++]=i)}return t},prepareNextBeginningIndexes:function(e){for(var r=e.length,t=d.prepareBeginningIndexes(e),n=new Array(r),o=t[0],a=0,i=0;r>i;++i)o>i?n[i]=o:(o=t[++a],n[i]=void 0===o?r:o);return n},cleanup:r,"new":e};return d}function r(){l.clear(),f.clear(),u=[],c=[]}function t(e){for(var r=-(1/0),t=e.length-1;t>=0;--t){var n=e[t];if(null!==n){var o=n.score;o>r&&(r=o)}}return r===-(1/0)?null:r}function n(e,r){var t=e[r];if(void 0!==t)return t;var n=r;Array.isArray(r)||(n=r.split("."));for(var o=n.length,a=-1;e&&++a<o;)e=e[n[a]];return e}var o="undefined"!=typeof require&&"undefined"==typeof window,a=-20,i=32,l=new Map,f=new Map,s=[];s.total=0;var u=[],c=[],p=function(){function e(){function e(){for(var e=0,n=r[e],o=1;t>o;){var a=o+1;e=o,t>a&&r[a].score<r[o].score&&(e=a),r[e-1>>1]=r[e],o=1+(e<<1)}for(var i=e-1>>1;e>0&&n.score<r[i].score;e=i,i=e-1>>1)r[e]=r[i];r[e]=n}var r=[],t=0,n=Object.assign({});return n.add=function(e){var n=t;r[t++]=e;for(var o=n-1>>1;n>0&&e.score<r[o].score;n=o,o=n-1>>1)r[n]=r[o];r[n]=e},n.poll=function(){var n=r[0];return r[0]=r[--t],e(),n},n.peek=function(e){return r[0]},n.replaceTop=function(t){r[0]=t,e()},n}return e}(),v=p();return e()});
